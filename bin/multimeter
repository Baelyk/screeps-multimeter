#!/usr/bin/env node

const configManager = require('../src/config_manager');
const nux = require('../src/nux');
const Multimeter = require('../src/multimeter');

Promise.resolve(configManager.loadConfig())
  .then(([path, config]) => {
    if (path) return config;
    // No saved config, need to run the NUX.
    return nux().then(([path, config]) => config);
  }).then((config) => {
    var app = new Multimeter(config);
    app.run();
    app.on('exit', () => {
      process.exit(0);
    });
  }).catch((err) => {
    console.error(err);
    process.exit(1);
  });
