#!/usr/bin/env node

const configManager = require("../src/config_manager");
const Multimeter = require("../src/multimeter");

process.on("unhandledRejection", function(err) {
  throw err;
});

Promise.resolve(configManager.loadConfig())
  .then(([path, config]) => {
    if (! path) {
      console.error('No config file found. Please create a .screeps.yaml config file.');
      process.exit(1);
    }
  })
  .then(() => {
    var app = new Multimeter(configManager);
    app.run();
    app.on("exit", () => {
      process.exit(0);
    });
  })
  .catch(err => {
    console.error(err);
    process.exit(1);
  });
